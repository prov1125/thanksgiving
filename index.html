<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ˜â›ª ëŠ˜í‘¸ë¥¸êµíšŒ ì¶”ìˆ˜ê°ì‚¬ì ˆ ì£¼ì‚¬ìœ„ê²Œì„ ğŸ²ğŸ²</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #fafafa;
      text-align: center;
      margin: 0;
    }
    h1 { margin: 20px; }
    #board {
      width: 1024px;
      height: 768px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      grid-template-rows: repeat(10, 1fr);
      border: 3px solid #333;
      background-image: url('image/dicemap.png');
      background-size: cover;
      background-position: center;
      position: relative;
      overflow: hidden;
    }
    .piece {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid white;
      position: absolute;
      transition: all 0.4s ease;
      z-index: 10;
    }
    .p1 { background: red; }
    .p2 { background: blue; }
    .p3 { background: green; }
    .p4 { background: orange; }

    button {
      padding: 8px 14px;
      margin: 6px;
      border: none;
      border-radius: 6px;
      background: #4CAF50;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #45a049; }

    #roll-btn {
      transform: scale(1.5);
      margin-bottom: 10px;
      background: #f44336; /* ë¹¨ê°„ìƒ‰ */
    }
    #roll-btn:hover { background: #e53935; }

    #sub-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      align-items: flex-start;
    }
    #sub-buttons button { transform: scale(1); }

    #last-roll {
      font-size: 18px;
      margin-bottom: 5px;
    }
    #bonus-roll-result {
      font-size: 16px;
      margin-top: 3px;
    }

    #victory-screen, #mission-popup, #reward-popup, #dice-popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 999;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
      flex-direction: column;
      animation: fadeIn 0.5s ease;
    }
    #victory-message, .popup-box {
      background: rgba(255,255,255,0.1);
      border: 2px solid white;
      border-radius: 20px;
      padding: 30px 50px;
      font-size: 22px;
      backdrop-filter: blur(5px);
      animation: popUp 0.5s ease;
    }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    @keyframes popUp { from {transform:scale(0.8);opacity:0;} to {transform:scale(1);opacity:1;} }
    #admin-panel {
      margin-top: 15px;
      padding: 10px;
      border: 2px dashed #999;
      width: 500px;
      margin: 0 auto;
      border-radius: 8px;
      background: #fff8;
    }
  </style>
</head>
<body>
  <h1>ğŸ˜â›ª ëŠ˜í‘¸ë¥¸êµíšŒ ì¶”ìˆ˜ê°ì‚¬ì ˆ ì£¼ì‚¬ìœ„ê²Œì„ ğŸ²ğŸ²</h1>

  <div id="setup">
    <button id="start-btn">ê²Œì„ ì‹œì‘</button>
  </div>

  <div id="team-setup" style="display:none;">
    <h3>íŒ€ ì´ë¦„ ì…ë ¥</h3>
    <input id="t1" placeholder="íŒ€ 1 ì´ë¦„">
    <input id="t2" placeholder="íŒ€ 2 ì´ë¦„">
    <input id="t3" placeholder="íŒ€ 3 ì´ë¦„">
    <input id="t4" placeholder="íŒ€ 4 ì´ë¦„">
    <br><button id="confirm-teams">í™•ì¸</button>
  </div>

  <div id="game" style="display:none;">
    <div id="board"></div>
    <p id="turn-display"></p>

    <div id="button-area">
      <p id="last-roll">ì£¼ì‚¬ìœ„: -</p>
      <button id="roll-btn">ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
      <div id="sub-buttons">
        <button id="skip-btn">â­ í•œ í„´ ì‰¬ê¸°</button>
        <div>
          <button id="bonus-roll-btn">ğŸ² ë³´ë„ˆìŠ¤ ì£¼ì‚¬ìœ„</button>
          <p id="bonus-roll-result">ë³´ë„ˆìŠ¤ ì£¼ì‚¬ìœ„: -</p>
        </div>
      </div>
    </div>

    <div id="admin-panel">
      <h4>ê´€ë¦¬ì ê¶Œí•œ</h4>
      <label>íŒ€ ì„ íƒ:
        <select id="admin-team">
          <option value="0">íŒ€1</option>
          <option value="1">íŒ€2</option>
          <option value="2">íŒ€3</option>
          <option value="3">íŒ€4</option>
        </select>
      </label>
      <label>ì´ë™ì¹¸ìˆ˜: <input type="number" id="admin-move" value="1" style="width:50px;"></label>
      <button id="admin-forward">ì•ìœ¼ë¡œ</button>
      <button id="admin-back">ë’¤ë¡œ</button>
      <br>
      <label>ë§ ë°”ê¾¸ê¸°:
        <select id="swap-team1">
          <option value="0">íŒ€1</option>
          <option value="1">íŒ€2</option>
          <option value="2">íŒ€3</option>
          <option value="3">íŒ€4</option>
        </select>
        â†”
        <select id="swap-team2">
          <option value="0">íŒ€1</option>
          <option value="1">íŒ€2</option>
          <option value="2">íŒ€3</option>
          <option value="3">íŒ€4</option>
        </select>
      </label>
      <button id="swap-btn">ë°”ê¾¸ê¸°</button>
    </div>
  </div>

  <div id="victory-screen">
    <div id="victory-message"></div>
    <button onclick="location.reload()">ğŸ” ë‹¤ì‹œ ì‹œì‘</button>
  </div>

  <div id="mission-popup">
    <div class="popup-box">
      <h2>ğŸ¯ ê°ì‚¬ ë¯¸ì…˜ ìˆ˜í–‰!</h2>
      <button id="mission-success">âœ… ì„±ê³µ</button>
      <button id="mission-fail">âŒ ì‹¤íŒ¨</button>
    </div>
  </div>

  <div id="reward-popup">
    <div class="popup-box">
      <h2>ğŸ ë‘ê·¼ë‘ê·¼ ë³´ìƒ ë½‘ê¸°~~</h2>
    </div>
  </div>

  <div id="dice-popup">
    <div class="popup-box">
      <h2>ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ëŠ” ì¤‘...</h2>
      <p id="dice-popup-number" style="font-size: 150px;">1ï¸âƒ£</p>
    </div>
  </div>

  <script>
    const board = document.getElementById('board');
    const rollBtn = document.getElementById('roll-btn');
    const skipBtn = document.getElementById('skip-btn');
    const bonusRollBtn = document.getElementById('bonus-roll-btn');
    const turnDisplay = document.getElementById('turn-display');
    const victoryScreen = document.getElementById('victory-screen');
    const victoryMessage = document.getElementById('victory-message');
    const missionPopup = document.getElementById('mission-popup');
    const rewardPopup = document.getElementById('reward-popup');
    const dicePopup = document.getElementById('dice-popup');
    const dicePopupNumber = document.getElementById('dice-popup-number');
    const lastRoll = document.getElementById('last-roll');
    const bonusRollResult = document.getElementById('bonus-roll-result');

    const startBtn = document.getElementById('start-btn');
    const teamSetup = document.getElementById('team-setup');
    const confirmTeams = document.getElementById('confirm-teams');
    const gameDiv = document.getElementById('game');

    let teams = [];
    let positions = [0,0,0,0];
    let currentPlayer = 0;
    const questionCells = [12, 22, 33, 44, 50, 55, 68, 89, 98];
    const diceNumbers = ['1ï¸âƒ£','2ï¸âƒ£','3ï¸âƒ£','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£'];
    let finishedTeams = [];

    const snakeLadder = {
      8: 14, 37: 15, 30: 49, 27: 66, 40: 61, 36: 45,
      62: 43, 71: 53, 87: 54, 57: 76, 97: 78
    };

    startBtn.addEventListener('click', () => {
      document.getElementById('setup').style.display = 'none';
      teamSetup.style.display = 'block';
    });

    confirmTeams.addEventListener('click', () => {
      teams = [
        document.getElementById('t1').value || 'íŒ€1',
        document.getElementById('t2').value || 'íŒ€2',
        document.getElementById('t3').value || 'íŒ€3',
        document.getElementById('t4').value || 'íŒ€4'
      ];
      teamSetup.style.display = 'none';
      gameDiv.style.display = 'block';
      initGame();
    });

    function initGame() {
      for(let i=0;i<4;i++){
        const piece = document.createElement('div');
        piece.className = `piece p${i+1}`;
        board.appendChild(piece);
      }
      updatePieces();
      turnDisplay.textContent = `${teams[currentPlayer]}ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.`;
    }

    rollBtn.addEventListener('click', () => {
      dicePopup.style.display = 'flex';
      let count = 0;
      let rollResult = 1;
      const roulette = setInterval(() => {
        const idx = Math.floor(Math.random()*6);
        dicePopupNumber.textContent = diceNumbers[idx];
        rollResult = idx + 1;
        count++;
        if(count >= 20){
          clearInterval(roulette);
          setTimeout(() => {
            dicePopup.style.display = 'none';
            lastRoll.textContent = `ì£¼ì‚¬ìœ„: ${diceNumbers[rollResult-1]}`;
            movePlayer(currentPlayer, rollResult);
          }, 500);
        }
      }, 100);
    });

    bonusRollBtn.addEventListener('click', () => {
      dicePopup.style.display = 'flex';
      let count = 0;
      let rollResult = 1;
      const roulette = setInterval(() => {
        const idx = Math.floor(Math.random() * 6);
        dicePopupNumber.textContent = diceNumbers[idx];
        rollResult = idx + 1;
        count++;
        if(count >= 20){
          clearInterval(roulette);
          setTimeout(() => { 
            dicePopup.style.display = 'none';
            bonusRollResult.textContent = `ë³´ë„ˆìŠ¤ ì£¼ì‚¬ìœ„: ${diceNumbers[rollResult-1]}`;
          }, 500);
        }
      }, 100);
    });

    skipBtn.addEventListener('click', () => nextTurn());

    function movePlayer(player, roll){
      let target = Math.min(positions[player] + roll, 100);
      let interval = setInterval(()=>{
        if(positions[player] < target){
          positions[player]++;
          updatePieces();
        }else{
          clearInterval(interval);
          if(snakeLadder[positions[player]] !== undefined){
            const slTarget = snakeLadder[positions[player]];
            setTimeout(()=>{
              positions[player] = slTarget;
              updatePieces();
            }, 500);
          }
          if(positions[player]===100 && !finishedTeams.includes(player)){
            finishedTeams.push(player);
            alert(`ğŸ‰ ${teams[player]} íŒ€ì´ ê³¨ì¸í–ˆìŠµë‹ˆë‹¤!`);
          }
          if(questionCells.includes(positions[player])){
            triggerMission(player);
          }else{
            nextTurn();
          }
        }
      },700);
    }

    function updatePieces(){
      const pieces=document.querySelectorAll('.piece');
      pieces.forEach((piece,i)=>{
        const pos=positions[i];
        if(pos===0){
          piece.style.left='-50px';
          piece.style.top='728px';
        }else{
          const {x,y}=getCoordinates(pos,i);
          piece.style.left=`${x}px`;
          piece.style.top=`${y}px`;
        }
      });
    }

    function getCoordinates(pos, idx){
      const cellX = 102.4;
      const cellY = 76.8;
      const row = Math.floor((pos-1)/10);
      let col = (pos-1)%10;
      if(row % 2 === 1) col = 9 - col;
      const offsetX = idx*5;
      const offsetY = idx*5;
      const x = col*cellX + 7 + offsetX;
      const y = 768 - (row+1)*cellY + 7 + offsetY;
      return {x, y};
    }

    function nextTurn(){
      if(finishedTeams.length === 4){
        victoryMessage.textContent = `ğŸ‰ ëª¨ë“  íŒ€ì´ ê³¨ì¸í–ˆìŠµë‹ˆë‹¤! ìˆœìœ„: ${finishedTeams.map(i => teams[i]).join(', ')}`;
        victoryScreen.style.display='flex';
        return;
      }
      do {
        currentPlayer = (currentPlayer + 1) % 4;
      } while(finishedTeams.includes(currentPlayer));
      turnDisplay.textContent = `${teams[currentPlayer]}ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.`;
    }

    function triggerMission(player){
      missionPopup.style.display='flex';
      document.getElementById('mission-success').onclick=()=>{
        missionPopup.style.display='none';
        rewardPopup.style.display='flex';
        setTimeout(()=>{
          rewardPopup.style.display='none';
          nextTurn();
        },5000);
      };
      document.getElementById('mission-fail').onclick=()=>{
        missionPopup.style.display='none';
        nextTurn();
      };
    }

    document.getElementById('admin-forward').onclick=()=>{
      const team=+document.getElementById('admin-team').value;
      const move=+document.getElementById('admin-move').value;
      positions[team]=Math.min(positions[team]+move,100);
      updatePieces();
    };
    document.getElementById('admin-back').onclick=()=>{
      const team=+document.getElementById('admin-team').value;
      const move=+document.getElementById('admin-move').value;
      positions[team]=Math.max(positions[team]-move,1);
      updatePieces();
    };
    document.getElementById('swap-btn').onclick = () => {
      const t1 = +document.getElementById('swap-team1').value;
      const t2 = +document.getElementById('swap-team2').value;
      const temp = positions[t1];
      positions[t1] = positions[t2];
      positions[t2] = temp;
      updatePieces();
    };
  </script>
</body>
</html>
